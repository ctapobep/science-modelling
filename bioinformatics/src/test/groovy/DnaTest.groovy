import groovy.transform.CompileStatic
import org.junit.Test

import static Dna.dna

@CompileStatic
class DnaTest {
  @Test void 'empty fasta results in empty DNA list'() {
    assert !Dna.parseFasta('')
  }

  @Test void 'hamming distance for identical DNAs must be 0'() {
    assert 0 == dna('ACGT').hammingDistance(dna('ACGT'))
  }
  @Test void 'hamming distance > 0'() {
    assert 7 == dna('GAGCCTACTAACGGGAT').hammingDistance(dna('CATCGTAATGACGGCCT'))
    assert 457 == dna('ACGGATCTAACGTAGTAACATAAACACCACCTGCCTTTGTGATCGTGGAACAGGTCAGCTGGCAAGGGTCGGGAGGCAAGTGAAGTGAAAAATCGGGAGAGGGGTGCGATGCCATTTGACTATAATTGTTGCAAGAATGCGCACCGCCCAACAATACCTTGGGTATTACCCACCAAGTGTCGTCCGGGGGTGTCCCACAAGGGTAATGGGTGTACATCTTCAGTATTCCTCAGATCAGCGACTCGTCCGAAGCATGCCAGATCAAAGACCATTTGACAGGCTCTTACACTCTCGGTACCTAACCAATCCCTGCTAGATCGCTGACCGACCTTGTTCCATCACGTTCGTCCAGTCAACGAATTGCCATAGTATTTGGTGCAGACCCATAATTCGGGCTTGAGCATGCTTACTACTTTAGATGAGATGCCAGTGGCCAGGCTGCTGGTTAGCTTAAGCAGGCGTATCCTATGGGATGGCACAAGGCATCGTGGTGTCTCGACAGAAGTCTCTAAGTAAGCCTGCGTTTTGGTGTTCACGTCTAGTCAACCTCCCGTCTAAAGGAAGTCATTTTCGTCGTAACCGCTGAGGAAGACCGCACTCACCAGAGCGCGCACGGCATCCACACTGACCACCGATAACAATCAGTGTGTTTCAAAACAACTAGGGCGAATAGAAGCATAGTACGTCGATTGCTTACGTAACCGGATCAGGGCGCGCAGAAACTTACACCCCTAAAGGGCTCCTAATACGCCATTGTTGTCAATCGTGTAGCTAAACGGGGATTATCGTCCTAGAGTTCTAAAATGGATGGATGGCTTCAACGTCTTTTACCAACAATTCCGACGTTACAAAGGTTCGGGTTTCGTTCTACTCTCTCATGAATCGGTAATCATAAGCGCTGCTTCCAGCCTAGCGTCTGCCTGGATCTAGACTGAAACTAGCTTAGCGG')
        .hammingDistance(dna('CCCGTGCCTAAGTAGTAGTAGTGAGCGCACCTGCTTCACGGATATAGCGGGCGCGCATCCAGTAACCTTACAGAGGCAACGGGAGTGATAACACGGTCAGACCATGGGACCGCTTTACACAAGTTTTGTCGCCAGTCTGAACACCATGCGATCATGTCTTGTGGTAAAACCACCGCGTGCGATTCGAATCCGGTGTAAAGAGTTAACCTCTGTAATGCCGCTGGATGTTTACCCCCGGGGTGGCGCCTGAGTCACCACCGTTCAAATACCATCCTACAGCACATTGGACACCCGGGACCTATCGACGCAAAGATATTGCGTATACGGACCCTGGTGTGACGACTTGACCCGGCTAAGGGAACGCCTGTGGACGTGTGAAAACGGCAAAATTAGGGCTTGAGATGACCAACTATTGTCCATGAGATGACCATGGCGAGACGCATACCGTCCCTTCGCAGGAGTACCCGACTACGCGGAACAAGGCCATGGGGTACAGAGACCTAACTTGCCTCGGGATCCTGTGTTTCGACCTGCATGTAGTGTAATGCGCCGGTCTGAAGCTAGGCGTTATCGTGTCAATAGCTAAAGGAGTGCCTGATTGACAGGCTGCCCACAGCCCACACTAAGTCCATACATGACAATCTGTTACCTCTCGATCAATTAGATGGTGTCGGACAATCTTAACTCGCTCGCTAACATAAACGAATTAGAGCGTTTGCCCACTAGCGTCGCGGGAGGGCTGCTAATCCTACATTGGGCCCAGTCGTTAAAACTAAGCGCATTTAACAACCCTGATCTTGTAAATGGATCAAACACACGCCGCTATTCTAATAATTGCTCCTAGACTACGAAGGTGGGCGTATCGAGCTTATTTTTCATGCTTCCCTCGACCGCTTGCCTATTTGCCGGCTAACGAAGGGTTTGCGCTAGACTGAAATTCGCACACGGG'))
  }

  @Test void 'fasta with one DNA sequence must return one DNA'() {
    String sequence = '>Rosalind_6404\n' +
        'CCTGCGGAAGATCGGCACTAGAATAGCCAGAACCGTTTCTCTGAGGCTTCCGGCCTTCCC\n' +
        'TCCCACTAATAATTCTGAGG'
    def dnas = Dna.parseFasta(sequence)
    assert 1 == dnas.size()
    assert 'Rosalind_6404' == dnas[0].id
    assert 'CCTGCGGAAGATCGGCACTAGAATAGCCAGAACCGTTTCTCTGAGGCTTCCGGCCTTCCCTCCCACTAATAATTCTGAGG' == dnas[0].sequence
  }

  @Test void 'fasta with >1 DNA seq must return multiple DNAs'() {
    String sequence = '>Rosalind_6404\n' +
        'CCTGCGGAAGATCGGCACTAGAATAGCCAGAACCGTTTCTCTGAGGCTTCCGGCCTTCCC\n' +
        'TCCCACTAATAATTCTGAGG\n' +
        '>Rosalind_5959\n' +
        'CCATCGGTAGCGCATCCTTAGTCCAATTAAGTCCCTATCCAGGCGCTCCGCCGAAGGTCT\n' +
        'ATATCCATTTGTCAGCAGACACGC\n' +
        '>Rosalind_0808\n' +
        'CCACCCTCGTGGTATGGCTAGGCATTCAGGAACCGGAGAACGCTTCAGACCAGCCCGGAC\n' +
        'TGGGAACCTGCGGGCAGTAGGTGGAAT'
    def expectedIds = ['Rosalind_6404', 'Rosalind_5959', 'Rosalind_0808']
    def expectedSeqs = ['CCTGCGGAAGATCGGCACTAGAATAGCCAGAACCGTTTCTCTGAGGCTTCCGGCCTTCCCTCCCACTAATAATTCTGAGG',
                        'CCATCGGTAGCGCATCCTTAGTCCAATTAAGTCCCTATCCAGGCGCTCCGCCGAAGGTCTATATCCATTTGTCAGCAGACACGC',
                        'CCACCCTCGTGGTATGGCTAGGCATTCAGGAACCGGAGAACGCTTCAGACCAGCCCGGACTGGGAACCTGCGGGCAGTAGGTGGAAT']
    def dnas = Dna.parseFasta(sequence)

    assert 3 == dnas.size()
    assert expectedIds == dnas.collect { Dna it -> it.id }
    assert expectedSeqs == dnas.collect { Dna it -> it.sequence }
  }

  @Test void 'calculating GC content'() {
    assert 0D == dna('AT').gcContent()
    assert 0D == dna('').gcContent()
    assert 50D == dna('CGAT').gcContent()
    assert 100D == dna('CG').gcContent()
    assert 100D == dna('CC').gcContent()
    assert 100D == dna('GG').gcContent()
  }

  @Test void 'sort by GC content'() {
    def dnas = Dna.fromStrings('GCAT', 'GCCT', 'T')
    dnas.sort(new Dna.ByGcRatioDescComparator())
    assert ['GCCT', 'GCAT', 'T'] == dnas.collect { Dna it -> it.sequence }
  }

  @Test void 'determine highest GC content'() {
    String seq = """>Rosalind_6404
CCTGCGGAAGATCGGCACTAGAATAGCCAGAACCGTTTCTCTGAGGCTTCCGGCCTTCCC
TCCCACTAATAATTCTGAGG
>Rosalind_5959
CCATCGGTAGCGCATCCTTAGTCCAATTAAGTCCCTATCCAGGCGCTCCGCCGAAGGTCT
ATATCCATTTGTCAGCAGACACGC
>Rosalind_0808
CCACCCTCGTGGTATGGCTAGGCATTCAGGAACCGGAGAACGCTTCAGACCAGCCCGGAC
TGGGAACCTGCGGGCAGTAGGTGGAAT"""
    def dnas = Dna.parseFasta(seq)
    dnas.sort(new Dna.ByGcRatioDescComparator())
    assert 'Rosalind_0808' == dnas[0].id
    assert 60.919540d.round(3) == (dnas[0].gcContent() as Double).round(3)
  }

  @Test void 'determing highest GC content (big fasta)'() {
     String seq = """>Rosalind_0702
CTAGGCATTGTACACCTGTGTAGGGATCTGTATGCGGGGCTAGACTATTTGGTCACAGAC
TTCCTCGATTAGGCCGACCGGTCAAAGATTCACAGCCTGCTGACGAAACTGCCGTCAGGG
TGATCGTGCATACCAGAGCCATCTTCGTATCAGCCTCCTTTCCGATGGCTGAGATTGGGT
TTATGGCCTATCACGTGCTAACATAGTACTGGTAAATTAGCACTGCCCAGTAGTAGGAGC
GACTGTAGGTATTATTTGTGAATTCCCCTTTCTCCAAAAAGAGTTTCTACTCTCAGACCT
TGAGGCCTGATGGATAACGAGTATTCACTCAGAGCGTGTCGCCACTTGCCGCCGGTACGA
CAACGTGTAGATTTCGAACATATAGCAGTGTGGAAGTCGCCAGAATGCAGCCTCTTGGAC
CGTTGTATCTTGAGCCGTGGTGATCCGCCTCCAACAGAGGGAAGTTCTACCTTTCACGAC
TCCCCAAGAAGATCCCCGTGGAGTCTTCTCGCTGATGTACCCGATAGTATCAACGCCGAG
CACTGACCCATTCACGGGTGTTGCGGGATGACGAAGTTGGGAAACCCATATCTTGTTGCG
CAGCCCGAAGTCGTCCCTAAAACCGGCTTCCGAGATGCCCTGTACGGTTGCGCCCGGGTT
AGTTAGTGCTGAGACGCTACCGTGTCTCAATTGTATACTCCCAATACCGGTGTATCTTAT
CCTAATCCAGCAGCAAAAGGCTCCCGGGCGCAGAATTCAACGGGTACGTTTGCACAATTT
AGTAAGCTGAAGCGTGTCGAATATGAAAGGTGCACTCTTCGACACCGAAAATTGTGGAAC
GCAGAGCAAAGAGTGAGCGAGATTATCGCCC
>Rosalind_8897
ACCCATTAGCAAGCGTCAATTAACTAGACCGGGCTATCATGCCTCTATGAACATGTCCAC
GGTCCCGGTGATAATAAGATAATCCGACCCAGTGAGGGACGGGGAAGCATCAACGGCGTT
GCTTCCCCTTGGTCGGGTAATCGTACAAAGTGATAACCCTTGCACCGTAAGCACGAGGCG
CGCTCATATGCTGGAAGTTGCCTGGTTTCTCATAGATTCTCAACGCTCACCCGAAGGGAT
CCGGGAGGGTCGAATGAAGTAGCAGTAGTTTGCTTTGCCACGACAGATTGTATGTCTACG
GAGTCCGGTTCCTTACACACAAAGTAACAAGCCTTTACGATCGGTTGTCTCGATAGATTG
AAGTGTTTCTTCTCCCGAAACGCGTTGAGCTCACAGACATAGAGTATCGAGTCGTAGTCA
TAGCAGGTTTTTCGGTAAAGCTTTGGAAGTACCGCTCAACGTGACCTGTGACTTCCGTCG
CCAATGTCGCCCGATACGCCAGCTCGACCGCGTTAGGTGTGGGTTAGGCTATGAAAAAAC
GGTATGGCTCATAACGGGTCGAACAGACCGTGCTTCATCAGATATCGCTGTGTGCACATA
GAGGTAAGTAATTGCGCGCGACGTTCAATACATCCAATCGTTAGACTCGTAGTTTAACCA
TTCTAGCTATGCAGATATCCTATCGTAGTCCGATACAGCACTGAGTATCCCTGGCACGGC
GCGCGCCACGCGTAATTCGTTGGCTTGAGAGTCCCAGCGTCGATACCGCATGAAGTCGCA
CTTAGCATAGTTTGCAACAAGGCCTACGCGCCGCCGGATGTTGTTTCTCGTTGTACGACT
TTCTGACAATCGTCTTTTTAACCTGGATAAGATTTGACGAGCTT
>Rosalind_1070
CGTTGAGTAAGCTGCGATTGGCTTTGAAAAAAGTTCTCCCAGCCCCAGCGCCTTATGCCA
CATGCGGGCTTGCTATTATCCAACACTGTGGGTTCCAACTGCGTGCACATACCTTCAGAA
ATAATTTGGATGTTGAAGGACCTGCCCATGAATTCCCGCCATAGAGGCTCGTCGCACCTA
CCGGGTTTTTTATGTTGATAATTTGCGATGTGACTAGGATATCACTTCGTGGTAGACTAA
ATCGAGGCTTGGACACTTGAAGGACCCGCCGCCCGAACCTCTCCGTGTGCTAATCTCACG
CTAACACTGCCCCTCGTCGTAATAACCCGGGAGTTCCACTAGCAACTGTTGATGGCGCAC
CTACTATCGGACAATGAAATCCCCGAGCATTTTTTAATGTTACTTCAGATGGAGAGTCAC
TCAGAATGCAGGTAACTAGGGGCCCCAATTGATTATTAGTACACCGTATTTTAGGAACGG
CTAGCCGTGTGACCACCCCAAAGTCCCGACGTTTGTTATGCAAGCAACTAAACGTCTGAA
AGAGAATGGGGACGCCAGGCACCTAACTATTCGACAGAAAAGGACCATGCCTTCAAGGGA
CGTTTCTGGGAAGATCTAGCTGCCCACTACATAGGAGTTGCTACCACAAAGCGACTAGTA
GACCCTGGAATTAACTACGAAGACGCCCCAGGGTGGTTGAACCCGAATCCGGTTAAGATT
CGTCGCTAAGAGTGAAATGTGTATAGGGGTAGACACTGTTCGCGGAGGTTCACTGTTAAT
ACGGGATATGATAGCCAATTTTGCCCGTCACCGCACGCCCACGTTCCA
>Rosalind_6830
AGGAGCAACTCTTATGTCCTACTTGCGGCGCGCATACTCGATAAGTTTAGACGGAATGTT
TCTCTGGGTATATAACACGGCCCGGACTGTAAGGTGGAATAAGCCTGTGCAAACCACAAT
GAGGTTTTCCGATGCTACCCGGCGATAATATACACTAGACGGAAGTGAGAGCATGCCATC
GTAGGGAGGTGGTAGCAGTACCATAGCCAGTAAAATGGTTCATGCGGATTCGAGGTCGTG
GGGACCTTTAAGGGTGAGGCTGCGAGTGTTAATGCGCTTTTCAGTAATTGCCGTGGTGTG
ACCTTTGCCAAAGAGAACTCTGACTGAATACGCCCGGATTACAGGGTAGAACCAGTCTGC
GGCATCGTCTTCTGTTCGTTTTGTGGGACAAGCATTACTGGTTTGAGAGATAAAGTAATA
GATCAAACACACTTCACTGGACGCACTCTGCCATCCGCCTAAAGACCATTTGACTCGCCC
ACGGTGTTTAACTCCTTGATACACTATGGCCGGTCTCCCAGAATATACGTTAAGGCTCTG
AGGTCCGGCCTTGGGGACCACCCTCCACGTATAACTTCAGCGACAAGCCCAATGATCTTA
GCTATACTCGTTGCCCAAGGGAGTAAGGAAAATCTCGGATGACTCAGAATCAGCCGTGTG
GCGACCATCAGATAGATCCGACGAGGCCGCTGGGTTTCCGTCGGGCGGTTGCCCCCGATC
CGTGACTACAGTAGGAACACTTGTCTTGACTTGCCAGTCCTCCTGGGGCTCCACTGTTTC
CGATGTCCTTATGGTGTAGTAGGTTCAATACGGTG
>Rosalind_8435
CGTGGCAGAGCACCCATTCCCCTCGTTTGGTGAAAAACGCACCGCCCGTGTAGCATCTAG
TGTGTTTACCTTGTACTGCTTCTATTCAACTGCCCGATAATGGGTGGTGAAGCCATTCAC
GCAAGGCAAGCCCCTTGTATAGTATCACACAGCAAGGGCGAGTTCTCGATACCGAGCTAG
CAGTGCTGAAACCGACTAGTGGATACCCTGATCGAGCGGTCCGCGTATGGAGATGTCCAG
GTCGGACCTTGCATTGAAAGCTTGCCCTGCCCAATATCCGGGTATCAGGGGATATAGCAG
CGATGGGTAGCTACGCCACATAGACAGATACGTGCAATATACAGTGGGGACGCAGTCTTG
TGGTGTCTCTGTTAGTTGCACAGATAATTCGTTCTCAAACACACGACTTATAAAACAGTC
GTGCCTCAGCAAAATACAAAATCCTTGGATGCTTCTCCCTACTGTCACTAGAACGCAGAG
CACCAGCCCCATTCGCCGATATAGAGTTTTGTCGTGAGGCAAGTCACAAATTATTTGACT
CCATTTGGCCTTCTTTTCGCTGTCTAGGTTAAAACCGTGCGGGCTAGGCATCAATTTCCA
CAGTCTTCTGCACTAGCCGATCCCCAGATACCAATTCATTAGTTTATCGTAGACCGTCAC
GTTTGACGTGACCTATAAACCCGTCCTCCACGTAGCTGCAGGCCGCGTGGAGCCGTCGTT
TATCCCCCAGTGGGACAGCGTCCATATTCGGGCAGGGCGCCGCCGCAAGGGTTTCGATAA
TCAAACTTCCGTGGTCGGCCGCAAACGGTGTGCCTTGATAATATTGTACTACTAGCCAAC
CGTACAAGACCTTAGCAGGTCGAGCTCTAGTACGGTGGACGCGTAATGATCATCCGACTT
GACCTTTAATCAAATCAAGGCCACTGTCAAGCCAATGCACTCTGTATTAGCCATGATCTA
ACGGACGAGTGCCGGCGA
>Rosalind_9397
GTCCATTCCTCCGACCAGGTATGTAGTTCCTAGAGTTAGATAGTGCTCAGACTAGTAAAA
TGTGGGTATCAAATTAACCCTGGGACCCGCGAGCGGAAATCGATGTTATGGCTATTCTGC
GAATCATGAGAACTGTTTATAGCTTGAACTTTTAGAGAAGCCCGTATAGGCTGCTTCAAG
ATACGGTGTGCTTGCCTGGAGATTCGGCCGAGAACTTGTCCAATTATGCCTTATTCTCTA
CAGTCCGGAGTTAGATTTGGACATCCTTCTGCAACGCAGGTCGGATTCAACTGACCCGTC
GGTCTACACCGGCAAAACTCCTTCGCACAAAGGGCAAGTCCAGCTGGTAGTCCGTGTGAT
TCTTTGGAACTTATGAGCAACTATCCTATATTTGATCCGTCACATCAGGTGGTCGGTTCG
ACCGTCGACCAAGCAGGCGGGCCACTGCACTTCCAACCTTCAATTTCACGTTTGTTAACA
ATGTCTTGCTTGCTTCCGCTGCCAACCCTGTAAACTCCCGACTTACCTGAATTTCCGTGG
CCATTCTGCTATCCGGCTACTCGGAGCGGCTAAGTGCACCATCGTACGATAGGTGGTTTC
GTATCCGCGAAAGAGAAGTCGAAGACTAAGCGTCGCGACTGCTGGGGATCCCGAGCAGTC
TACCGATGCTTAATCTGTTCAACCAGCAGTTTCCTCTTTGTGACCTCTACTCTCAGCAGG
GCTCGTTTCGTGGTAGCCACGAAACTTATTGATTGTGCACTTTCTTGCTTTCGATTCACT
CATGTAGAGCATGAAAACCGACAGCAATTTTGCAAAGGCTGTGCTGGTTACATATGGGCT
TGAACCACTACCCTGTCTCACAGGCTTTTGCAAAGGCGGCCAATTTACAATCTCTAGCAA
GCTCTAAAAACTTCTAAGCAGACCAGCAGCTGGCCATTGGACCAGCCGAATTTATCCTAC
AAGGGACGTGAGGGTGATTTG
>Rosalind_9350
CGGCTCGCTACGGTTATCCATCGCACCACAGCGCTTCTGATCGCTTTTGTGCCCTGAAGG
TTTATCCAATCTAAATCTACAGACTGTGTTGGCGGTTAGACGGGGTCGAAGGCCGCCGTG
AAGCTGATAGGTGCACATTGATTTTTGTCGTCCAAGTAGTCCTTATACTCATACTTTATG
TTTATTGAGTGCGCCTTTCAGTGAGGGAACTGACCGGGCGCACCACGTGGGGTAGCTCTC
AACGGGAGTAGGAGCTCTAGTGCACCATTCCTATAAAGACAGAGAATTGGTGAATAGCCC
CAGCAAAGCTCTTCGTACCAAGAAAGGACGAACGGGCGTAGACAGCACTCTCCCTGAGGA
GATATCCTATGGTTAAAGTTTTGAATATACACCTGTGAGCGGGAGCTAACTTGTTTTGGA
AGCATTTCTGAGTGTATATCACCTGGTGTAATCGTTTTGGTCCGCGCACTGGTGTTGGAG
GGGGCTTGACCTAGAGCCAAGTCCGGGGATAGGGTTGGACCAAGCGCTAGGAATTATTTT
GGCCGCGATTACATACACATCTTGCAGCCTTAGACAGTGACTGTATCAATCCGACGGTGT
TCACGGCGTTAATAGCAGCAGCACATCGTAGCTAATGTCATACCCTCAAGACAGAGCTTA
GCGAGGTGTTAAGGCGCCGACACCCATCAGTTCTGGATTGGTGTGCCACGTTACAGAGAA
GTCACTCAAGGATCTATTTCGTTACAGTCAACTGTGATTTACATAAGTAAATGCGTCCTC
CATTCGCCTTCTGATACAGACGAATTCGGCTGCGTTGAGCTACGGCCTAGCAACCGTACT
ACGAGGGGCGCTTACTCAATCCTCGCTG
"""
    def dnas = Dna.parseFasta(seq)
    dnas.sort(new Dna.ByGcRatioDescComparator())
    assert 'Rosalind_0702' == dnas[0].id
    assert 50.976d.round(3) == (dnas[0].gcContent() as Double).round(3)
  }
}
